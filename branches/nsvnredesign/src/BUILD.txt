Ankh source code

Subversion
Currently, to get a copy of the Ankh source code, you need to check it out using another SVN client. Further, in order to actually build it, you will also need to build Subversion itself. It then makes sense to start the process by building your own copy of the Subversion commandline client.

Note: The current source tree is only guaranteed to build against the 0.37 release of SVN.

Start by getting the 0.37 (http://subversion.tigris.org/servlets/ProjectDocumentList?folderID=260) source tarball. You will also need the VS.NET version of the Berkeley DB binaries, which can be found at  http://subversion.tigris.org/servlets/ProjectDocumentList?folderID=688. We are currently using the 4.2.52 version. Make sure you don't get the VC6.0 versions, since they will cause spurious access violations at runtime.

Extract the subversion tarball (using Winzip or similar). Then, extract the Berkeley zip into a directory called db4-win32 at the root of the tree (alongside the doc and build directories).

APR
Subversion relies on the Apache Portable Runtime(APR) library. Most of APR is included in the tarball, but to get Subversion to build on Win32 you will also need the apr-iconv module. You can check this out from the Apache CVS repository using a CVS client:

cvs -d :pserver:anoncvs@cvs.apache.org:/home/cvspublic login 
    (password: 'anoncvs')
cvs -d :pserver:anoncvs@cvs.apache.org:/home/cvspublic co apr-iconv
    
You may run into a problem with the supplied .dsp files in the tarball. If the person packaging it was using a UNIX machine, the line endings will probably be wrong and VS.NET will refuse to convert them. You can use an utility like unix2dos to fix this, or you can check out those modules from CVS using the approach described above(just substitute apr and apr-util for apr-iconv). All the modules need to be in the top-level directory of the Subversion source tree. 

Generating VS.NET project files
You will need Python installed in order to generate the VS.NET project files. Python distributions for many platforms, including Windows, can be downloaded from www.python.org. Once you have it installed, and in the PATH, open a command prompt and go to the root of the Subversion source tree. Type: 

python gen-make.py -t vcproj

Building Subversion
Open the solution by clicking on subversion_vcnet.sln at the root. Build the ALL project, preferrably in both Debug and Release configurations.

Create a new system environment variable, SVNSRC, to point to the Subversion source tree. This is necessary to get the Ankh build to locate the Subversion libraries and headers.

Ankh
Now you are ready to check out Ankh itself.

Type the following:

    svn checkout http://www.ankhsvn.com:8088/svn/finalproject/trunk/src ankh

Open and build src.sln (or src.2003.sln if you are using VS.NET 2003). Note that VS.NET might issue a false COM Interop error while trying to register Ankh. This is due to the fact that it is linking against the wrong Berkeley DB binaries (probably the ones from the instalation of the command line client). To correct this, simply place the path of the Berkley DB binaries before everything else in your system's PATH variable.

Run the ReCreateCommands.reg file in the Ankh directory. This will register the addin with VS.NET. If you are using VS.NET 2003 you need to edit this file where it says 7.0 and change it to 7.1.

To get VS.NET to recognize the custom menu icons, you need to edit SatelliteDll.reg in the same directory. Set the path for SatelliteDllPath to the correct one for your system, then run the .reg file.

Go into the Project Properties of the Ankh project. Choose Configuration Properties->Debug. Set Debug Mode to Program, and set Start Application to the path to devenv.exe on your system(Probably C:\Program Files\Microsoft Visual Studio .NET\Common7\IDE\devenv.exe).

Starting the Ankh project should now create a new instance of VS.NET with Ankh loaded.
